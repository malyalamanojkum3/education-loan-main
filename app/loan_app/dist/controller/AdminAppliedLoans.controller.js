sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/odata/v4/ODataModel"],function(t,e,o,a,n){"use strict";return t.extend("loanapp.controller.AdminAppliedLoans",{onViewDetails:function(t){sap.ui.core.BusyIndicator.show(0);var e=t.getSource().getBindingContext("mainModel");var o=this.byId("customerDetailsDialog");o.setBindingContext(e,"mainModel");o.open(sap.ui.core.BusyIndicator.hide())},onCloseDialog:function(){this.byId("customerDetailsDialog").close()},onApproveLoan:function(){sap.ui.core.BusyIndicator.show(0);var t=this.byId("customerDetailsDialog");var o=t.getBindingContext("mainModel");var a=this.getView().getModel("mainModel");var n=o.getObject();jQuery.ajax({url:"/odata/v4/my/approveLoan",method:"POST",data:JSON.stringify({Id:n.Id}),contentType:"application/json",success:()=>{a.refresh();e.show("Loan Approved");t.close(sap.ui.core.BusyIndicator.hide())},error:()=>{e.show("Error Approving Loan")}})},onRejectLoan:function(){sap.ui.core.BusyIndicator.show(0);var t=this.byId("customerDetailsDialog");var o=t.getBindingContext("mainModel");var a=this.getView().getModel("mainModel");var n=o.getObject();jQuery.ajax({url:"/odata/v4/my/rejectLoan",method:"POST",data:JSON.stringify({Id:n.Id}),contentType:"application/json",success:()=>{a.refresh();e.show("Loan Rejected");t.close(sap.ui.core.BusyIndicator.hide())},error:()=>{e.show("Error Rejecting Loan")}})},onLogout:function(){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("main");e.show("Logged out!")},onHome:function(){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("dashboard");e.show("Returned Home")},onSearch:function(t){var e=t.getSource().getValue();var n=[new o("applicantName",a.Contains,e),new o("applicantEmail",a.Contains,e),new o("applicantPHno",a.Contains,e),new o("applicantAadhar",a.Contains,e)];var s=new o({filters:n,and:false});var i=this.byId("loanList");var r=i.getBinding("items");r.filter(s)},onReset:function(){var t=this.byId("loanList");var e=t.getBinding("items");e.filter([]);e.sort([]);this.getView().byId("querySearch").setValue("");this.getView().byId("statusComboBox").setValue("All");this.getView().byId("GroupBy").setValue("")},onSort:function(){var t=this.byId("loanList");var e=t.getBinding("items");this._bSortAscending=!this._bSortAscending;var o=new sap.ui.model.Sorter("applicantName",!this._bSortAscending);e.sort(o)},onGroup:function(){var t=this.byId("loanList");var e=t.getBinding("items");var o=new sap.ui.model.Sorter("loanStatus",false,function(t){var e=t.getProperty("loanStatus");return{key:e,text:"LOAN STATUS : "+e}});e.sort(o)},onDefaultActionAccept:function(){sap.m.MessageToast.show("Default export action triggered.")},onBeforeMenuOpen:function(t){console.log("Menu is about to open.")},onExportAsPDF:async function(){try{const{jsPDF:t}=window.jspdf;const e=this.getView().getModel("mainModel");const o=e.bindList("/customer");const a=await o.requestContexts();if(!a.length){sap.m.MessageToast.show("No customer data found.");return}const n=new t;n.setFontSize(14);n.text("Customer Loan Details",20,20);let s=30;let i=1;for(const t of a){const e=await t.requestObject();n.setFontSize(12);n.text(`CUSTOMER ${i++}`,20,s);s+=10;n.setFontSize(10);n.text("ID: "+e.Id,20,s);n.text("Name: "+e.applicantName,20,s+=10);n.text("Email: "+e.applicantEmail,20,s+=10);n.text("Mobile: "+e.applicantPHno,20,s+=10);n.text("Aadhar No.: "+e.applicantAadhar,20,s+=10);n.text("PAN No.: "+e.applicantPAN,20,s+=10);n.text("Salary: "+e.applicantSalary,20,s+=10);n.text("Tenure: "+e.loanRepaymentMonths+" Months",20,s+=10);n.text("Principal: "+e.loanAmount,20,s+=10);n.text("Loan Status: "+e.loanStatus,20,s+=10);n.text("Address: "+e.applicantAddress,20,s+=10);s+=20;if(s>270){n.addPage();s=20}}n.save("AllCustomerLoanDetails.pdf")}catch(t){console.error("Error fetching customer data:",t);sap.m.MessageToast.show("Failed to export customer data.")}},onExportToExcel:async function(){try{const t=this.getView().getModel("mainModel");const e=t.bindList("/customer");const o=await e.requestContexts();if(!o.length){sap.m.MessageToast.show("No customer data found.");return}const a=[["ID","Name","Email","Mobile","Aadhar No.","PAN No.","Salary","Tenure","Principal","Loan Status","Address"]];for(const t of o){const e=await t.requestObject();a.push([e.Id,e.applicantName,e.applicantEmail,e.applicantPHno,e.applicantAadhar,e.applicantPAN,e.applicantSalary,e.loanRepaymentMonths,e.loanAmount,e.loanStatus,e.applicantAddress])}const n=XLSX.utils.aoa_to_sheet(a);const s=XLSX.utils.book_new();XLSX.utils.book_append_sheet(s,n,"Loan Details");XLSX.writeFile(s,"CustomerLoanDetails.xlsx")}catch(t){console.error("Error exporting Excel:",t);sap.m.MessageToast.show("Failed to export Excel file.")}},onMenuAction:function(t){var e=t.getParameter("item");if(!e)return;var o=e.getText();switch(o){case"Export as PDF":this.onExportAsPDF();break;case"Export to Excel":this.onExportToExcel();break;default:sap.m.MessageToast.show("Unknown export option selected.")}},onStatusChange:function(){var t=this.byId("statusComboBox").getSelectedKey();var e=this.byId("loanList");var n=e.getBinding("items");var s=[];if(t&&t!=="All"){s.push(new o("loanStatus",a.EQ,t))}n.filter(s);var i=this.byId("statusColumn");if(i){i.setVisible(t==="All")}e.setNoDataText(t==="Pending"?"Empty Right Now":"No Data Available")},isPending:function(t){return t==="Pending"}})});
//# sourceMappingURL=AdminAppliedLoans.controller.js.map